(function(M,o){M.ui=M.ui||{};var r,T=Math.max,S=Math.abs,x=Math.round,n=/left|center|right/,s=/top|center|bottom/,l=/[\+\-]\d+%?/,a=/^\w+/,f=/%$/,t=M.fn.position;function C(e,t,i){return[parseInt(e[0],10)*(f.test(e[0])?t/100:1),parseInt(e[1],10)*(f.test(e[1])?i/100:1)]}function $(e,t){return parseInt(M.css(e,t),10)||0}function i(e){var t=e[0];if(t.nodeType===9){return{width:e.width(),height:e.height(),offset:{top:0,left:0}}}if(M.isWindow(t)){return{width:e.width(),height:e.height(),offset:{top:e.scrollTop(),left:e.scrollLeft()}}}if(t.preventDefault){return{width:0,height:0,offset:{top:t.pageY,left:t.pageX}}}return{width:e.outerWidth(),height:e.outerHeight(),offset:e.offset()}}M.position={scrollbarWidth:function(){if(r!==o){return r}var e,t,i=M("<div style='display:block;width:50px;height:50px;overflow:hidden;'><div style='height:100px;width:auto;'></div></div>"),n=i.children()[0];M("body").append(i);e=n.offsetWidth;i.css("overflow","scroll");t=n.offsetWidth;if(e===t){t=i[0].clientWidth}i.remove();return r=e-t},getScrollInfo:function(e){var t=e.isWindow?"":e.element.css("overflow-x"),i=e.isWindow?"":e.element.css("overflow-y"),n=t==="scroll"||t==="auto"&&e.width<e.element[0].scrollWidth,o=i==="scroll"||i==="auto"&&e.height<e.element[0].scrollHeight;return{width:n?M.position.scrollbarWidth():0,height:o?M.position.scrollbarWidth():0}},getWithinInfo:function(e){var t=M(e||window),i=M.isWindow(t[0]);return{element:t,isWindow:i,offset:t.offset()||{left:0,top:0},scrollLeft:t.scrollLeft(),scrollTop:t.scrollTop(),width:i?t.width():t.outerWidth(),height:i?t.height():t.outerHeight()}}};M.fn.position=function(u){if(!u||!u.of){return t.apply(this,arguments)}u=M.extend({},u);var c,d,p,g,m,e,_=M(u.of),v=M.position.getWithinInfo(u.within),w=M.position.getScrollInfo(v),b=(u.collision||"flip").split(" "),y={};e=i(_);if(_[0].preventDefault){u.at="left top"}d=e.width;p=e.height;g=e.offset;m=M.extend({},g);M.each(["my","at"],function(){var e=(u[this]||"").split(" "),t,i;if(e.length===1){e=n.test(e[0])?e.concat(["center"]):s.test(e[0])?["center"].concat(e):["center","center"]}e[0]=n.test(e[0])?e[0]:"center";e[1]=s.test(e[1])?e[1]:"center";t=l.exec(e[0]);i=l.exec(e[1]);y[this]=[t?t[0]:0,i?i[0]:0];u[this]=[a.exec(e[0])[0],a.exec(e[1])[0]]});if(b.length===1){b[1]=b[0]}if(u.at[0]==="right"){m.left+=d}else if(u.at[0]==="center"){m.left+=d/2}if(u.at[1]==="bottom"){m.top+=p}else if(u.at[1]==="center"){m.top+=p/2}c=C(y.at,d,p);m.left+=c[0];m.top+=c[1];return this.each(function(){var i,e,s=M(this),l=s.outerWidth(),a=s.outerHeight(),t=$(this,"marginLeft"),n=$(this,"marginTop"),o=l+t+$(this,"marginRight")+w.width,r=a+n+$(this,"marginBottom")+w.height,f=M.extend({},m),h=C(y.my,s.outerWidth(),s.outerHeight());if(u.my[0]==="right"){f.left-=l}else if(u.my[0]==="center"){f.left-=l/2}if(u.my[1]==="bottom"){f.top-=a}else if(u.my[1]==="center"){f.top-=a/2}f.left+=h[0];f.top+=h[1];if(!M.support.offsetFractions){f.left=x(f.left);f.top=x(f.top)}i={marginLeft:t,marginTop:n};M.each(["left","top"],function(e,t){if(M.ui.position[b[e]]){M.ui.position[b[e]][t](f,s,{targetWidth:d,targetHeight:p,elemWidth:l,elemHeight:a,collisionPosition:i,collisionWidth:o,collisionHeight:r,offset:[c[0]+h[0],c[1]+h[1]],my:u.my,at:u.at,within:v,elem:s})}});if(u.using){e=function(e){var t=g.left-f.left,i=t+d-l,n=g.top-f.top,o=n+p-a,r={target:{element:_,left:g.left,top:g.top,width:d,height:p},element:{element:s,left:f.left,top:f.top,width:l,height:a},horizontal:i<0?"left":t>0?"right":"center",vertical:o<0?"top":n>0?"bottom":"middle"};if(d<l&&S(t+i)<d){r.horizontal="center"}if(p<a&&S(n+o)<p){r.vertical="middle"}if(T(S(t),S(i))>T(S(n),S(o))){r.important="horizontal"}else{r.important="vertical"}u.using.call(this,e,r)}}s.offset(M.extend(f,{using:e}))})};M.ui.position={fit:{left:function(e,t,i){var n=i.within,o=n.isWindow?n.scrollLeft:n.offset.left,r=n.width,s=e.left-i.collisionPosition.marginLeft,l=o-s,a=s+i.collisionWidth-r-o,f;if(i.collisionWidth>r){if(l>0&&a<=0){f=e.left+l+i.collisionWidth-r-o;e.left+=l-f}else if(a>0&&l<=0){e.left=o}else{if(l>a){e.left=o+r-i.collisionWidth}else{e.left=o}}}else if(l>0){e.left+=l}else if(a>0){e.left-=a}else{e.left=T(e.left-s,e.left)}},top:function(e,t,i){var n=i.within,o=n.isWindow?n.scrollTop:n.offset.top,r=i.within.height,s=e.top-i.collisionPosition.marginTop,l=o-s,a=s+i.collisionHeight-r-o,f;if(i.collisionHeight>r){if(l>0&&a<=0){f=e.top+l+i.collisionHeight-r-o;e.top+=l-f}else if(a>0&&l<=0){e.top=o}else{if(l>a){e.top=o+r-i.collisionHeight}else{e.top=o}}}else if(l>0){e.top+=l}else if(a>0){e.top-=a}else{e.top=T(e.top-s,e.top)}}},flip:{left:function(e,t,i){var n=i.within,o=n.offset.left+n.scrollLeft,r=n.width,s=n.isWindow?n.scrollLeft:n.offset.left,l=e.left-i.collisionPosition.marginLeft,a=l-s,f=l+i.collisionWidth-r-s,h=i.my[0]==="left"?-i.elemWidth:i.my[0]==="right"?i.elemWidth:0,u=i.at[0]==="left"?i.targetWidth:i.at[0]==="right"?-i.targetWidth:0,c=-2*i.offset[0],d,p;if(a<0){d=e.left+h+u+c+i.collisionWidth-r-o;if(d<0||d<S(a)){e.left+=h+u+c;t.trigger("position.horizontal.flip")}}else if(f>0){p=e.left-i.collisionPosition.marginLeft+h+u+c-s;if(p>0||S(p)<f){e.left+=h+u+c;t.trigger("position.horizontal.flip")}}},top:function(e,t,i){var n=i.within,o=n.offset.top+n.scrollTop,r=n.height,s=n.isWindow?n.scrollTop:n.offset.top,l=e.top-i.collisionPosition.marginTop,a=l-s,f=l+i.collisionHeight-r-s,h=i.my[1]==="top",u=h?-i.elemHeight:i.my[1]==="bottom"?i.elemHeight:0,c=i.at[1]==="top"?i.targetHeight:i.at[1]==="bottom"?-i.targetHeight:0,d=-2*i.offset[1],p,g;if(a<0){g=e.top+u+c+d+i.collisionHeight-r-o;if(e.top+u+c+d>a&&(g<0||g<S(a))){e.top+=u+c+d;t.trigger("position.vertical.flip")}}else if(f>0){p=e.top-i.collisionPosition.marginTop+u+c+d-s;if(e.top+u+c+d>f&&(p>0||S(p)<f)){e.top+=u+c+d;t.trigger("position.vertical.flip")}}}},flipfit:{left:function(){M.ui.position.flip.left.apply(this,arguments);M.ui.position.fit.left.apply(this,arguments)},top:function(){M.ui.position.flip.top.apply(this,arguments);M.ui.position.fit.top.apply(this,arguments)}}};(function(){var e,t,i,n,o,r=document.getElementsByTagName("body")[0],s=document.createElement("div");e=document.createElement(r?"div":"body");i={visibility:"hidden",width:0,height:0,border:0,margin:0,background:"none"};if(r){M.extend(i,{position:"absolute",left:"-1000px",top:"-1000px"})}for(o in i){e.style[o]=i[o]}e.appendChild(s);t=r||document.documentElement;t.insertBefore(e,t.firstChild);s.style.cssText="position: absolute; left: 10.7432222px;";n=M(s).offset().left;M.support.offsetFractions=n>10&&n<11;e.innerHTML="";t.removeChild(e)})()})(jQuery);jQuery.migrationFixPosition=function(e){var t,i,n,o;function r(e){if(e[0]!=="-"&&e[0]!=="+"){e="+"+e}return e}if(!e){return e}if($().jquery.indexOf("1.7")>=0||$().jquery.indexOf("1.8")>=0){return e}t=e.at;i=e.offset;if(!i){return e}if(!t){return e}n=t.split(" ");o=i.split(" ");if(o.length){o[0]=r(o[0])}if(o.length>1){o[1]=r(o[1])}e.at=n[0]+o[0]+" "+n[1]+o[1];return e};var Mustache=typeof module!=="undefined"&&module.exports||{};(function(k){k.name="mustache.js";k.version="0.5.0-dev";k.tags=["<%","%>"];k.parse=d;k.compile=_;k.render=v;k.clearCache=m;k.to_html=function(e,t,i,n){var o=v(e,t,i);if(typeof n==="function"){n(o)}else{return o}};var t=Object.prototype.toString;var e=Array.isArray;var n=Array.prototype.forEach;var i=String.prototype.trim;var a;if(e){a=e}else{a=function(e){return t.call(e)==="[object Array]"}}var f;if(n){f=function(e,t,i){return n.call(e,t,i)}}else{f=function(e,t,i){for(var n=0,o=e.length;n<o;++n){t.call(i,e[n],n,e)}}}var o=/^\s*$/;function W(e){return o.test(e)}var H;if(i){H=function(e){return e==null?"":i.call(e)}}else{var r,s;if(W("\xa0")){r=/^\s+/;s=/\s+$/}else{r=/^[\s\xA0]+/;s=/[\s\xA0]+$/}H=function(e){return e==null?"":String(e).replace(r,"").replace(s,"")}}var l={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"};function h(e){return String(e).replace(/&(?!\w+;)|[<>"']/g,function(e){return l[e]||e})}function D(e,t,i,n){n=n||"<template>";var o=t.split("\n"),r=Math.max(i-3,0),s=Math.min(o.length,i+3),l=o.slice(r,s);var a;for(var f=0,h=l.length;f<h;++f){a=f+r+1;l[f]=(a===i?" >> ":"    ")+l[f]}e.template=t;e.line=i;e.file=n;e.message=[n+":"+i,l.join("\n"),"",e.message].join("\n");return e}function u(e,t,i){if(e==="."){return t[t.length-1]}var n=e.split(".");var o=n.length-1;var r=n[o];var s,l,a=t.length,f,h;while(a){h=t.slice(0);l=t[--a];f=0;while(f<o){l=l[n[f++]];if(l==null){break}h.push(l)}if(l&&typeof l==="object"&&r in l){s=l[r];break}}if(typeof s==="function"){s=s.call(h[h.length-1])}if(s==null){return i}return s}function c(e,t,i,n){var o="";var r=u(e,t);if(n){if(r==null||r===false||a(r)&&r.length===0){o+=i()}}else if(a(r)){f(r,function(e){t.push(e);o+=i();t.pop()})}else if(typeof r==="object"){t.push(r);o+=i();t.pop()}else if(typeof r==="function"){var s=t[t.length-1];var l=function(e){return v(e,s)};o+=r.call(s,i(),l)||""}else if(r){o+=i()}return o}function d(o,r){r=r||{};var t=r.tags||k.tags,e=t[0],i=t[t.length-1];var s=['var buffer = "";',"\nvar line = 1;","\ntry {",'\nbuffer += "'];var n=[],l=false,a=false;var f=function(){if(l&&!a&&!r.space){while(n.length){s.splice(n.pop(),1)}}else{n=[]}l=false;a=false};var h=[],u,c,d;var p=function(e){t=H(e).split(/\s+/);c=t[0];d=t[t.length-1]};var g=function(e){s.push('";',u,'\nvar partial = partials["'+H(e)+'"];',"\nif (partial) {","\n  buffer += render(partial,stack[stack.length - 1],partials);","\n}",'\nbuffer += "')};var m=function(e,t){var i=H(e);if(i===""){throw D(new Error("Section name may not be empty"),o,y,r.file)}h.push({name:i,inverted:t});s.push('";',u,'\nvar name = "'+i+'";',"\nvar callback = (function () {","\n  return function () {",'\n    var buffer = "";','\nbuffer += "')};var _=function(e){m(e,true)};var v=function(e){var t=H(e);var i=h.length!=0&&h[h.length-1].name;if(!i||t!=i){throw D(new Error('Section named "'+t+'" was never opened'),o,y,r.file)}var n=h.pop();s.push('";',"\n    return buffer;","\n  };","\n})();");if(n.inverted){s.push("\nbuffer += renderSection(name,stack,callback,true);")}else{s.push("\nbuffer += renderSection(name,stack,callback);")}s.push('\nbuffer += "')};var w=function(e){s.push('";',u,'\nbuffer += lookup("'+H(e)+'",stack,"");','\nbuffer += "')};var b=function(e){s.push('";',u,'\nbuffer += escapeHTML(lookup("'+H(e)+'",stack,""));','\nbuffer += "')};var y=1,M,T;for(var S=0,x=o.length;S<x;++S){if(o.slice(S,S+e.length)===e){S+=e.length;M=o.substr(S,1);u="\nline = "+y+";";c=e;d=i;l=true;switch(M){case"!":S++;T=null;break;case"=":S++;i="="+i;T=p;break;case">":S++;T=g;break;case"#":S++;T=m;break;case"^":S++;T=_;break;case"/":S++;T=v;break;case"{":i="}"+i;case"&":S++;a=true;T=w;break;default:a=true;T=b}var C=o.indexOf(i,S);if(C===-1){throw D(new Error('Tag "'+e+'" was not closed properly'),o,y,r.file)}var $=o.substring(S,C);if(T){T($)}var E=0;while(~(E=$.indexOf("\n",E))){y++;E++}S=C+i.length-1;e=c;i=d}else{M=o.substr(S,1);switch(M){case'"':case"\\":a=true;s.push("\\"+M);break;case"\r":break;case"\n":n.push(s.length);s.push("\\n");f();y++;break;default:if(W(M)){n.push(s.length)}else{a=true}s.push(M)}}}if(h.length!=0){throw D(new Error('Section "'+h[h.length-1].name+'" was not closed properly'),o,y,r.file)}f();s.push('";',"\nreturn buffer;","\n} catch (e) { throw {error: e, line: line}; }");var O=s.join("").replace(/buffer \+= "";\n/g,"");if(r.debug){if(typeof console!="undefined"&&console.log){console.log(O)}else if(typeof print==="function"){print(O)}}return O}function p(n,o){var e="view,partials,stack,lookup,escapeHTML,renderSection,render";var t=d(n,o);var r=new Function(e,t);return function(e,t){t=t||{};var i=[e];try{return r(e,t,i,u,h,c,v)}catch(e){throw D(e.error,n,e.line,o.file)}}}var g={};function m(){g={}}function _(e,t){t=t||{};if(t.cache!==false){if(!g[e]){g[e]=p(e,t)}return g[e]}return p(e,t)}function v(e,t,i){return _(e)(t,i)}})(Mustache);var SM;if(typeof module==="object"&&module.exports&&typeof require==="function"){SM=require("../SM")}SM.Html={rtagName:/<([\w:]+)/,rhtml:/<|&#?\w+;/,rxhtmlTag:/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,wrapMap:{option:[1,'<select multiple="multiple">',"</select>"],legend:[1,"<fieldset>","</fieldset>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],area:[1,"<map>","</map>"],_default:[0,"",""]},support:{},tagRexExes:{},safeFrag:null,init:function(){this._featureTest();this._extendWrapMap();this.safeFrag=document.createDocumentFragment()},hasTag:function(e,t){return!!this.findFirstTag(e,t)},findFirstTag:function(e,t){var i;t=t.toLowerCase();if(!this.tagRexExes[t]){this.tagRexExes[t]=new RegExp("<"+t+"\\s+(.*?)[^<]\\/?>","i")}i=this.tagRexExes[t].exec(e);return i?i[0]:null},getFirstTagName:function(e){return(this.rtagName.exec(e)||["",""])[1].toLowerCase()},removeExternalAttributes:function(e){return e.replace(/\s+(src|href)=/gi," data-src=")},strip:function(e,t){var i,n,o;if(!e){return""}if(t===undefined){t=true}i=document.createElement("div");e=this.removeExternalAttributes(e);i.innerHTML=e;o=i.textContent||i.innerText;if(t){while(o!==i.innerHTML&&o!==n){n=o;i.innerHTML=o;o=i.textContent||i.innerText}}return o===null||o===undefined?"":o},has:function(e){return this.rhtml.test(e)},parse:function(e){var t,i,n,o,r,s,l,a,f,h,u=[];if(!e||typeof e!=="string"){return[]}if(!this.has(e)){return[document.createTextNode(e)]}i=this.safeFrag;t=i.appendChild(document.createElement("div"));e=e.replace(this.rxhtmlTag,"<$1></$2>");n=this.getFirstTagName(e);o=this.wrapMap[n]||this.wrapMap._default;r=o[0];t.innerHTML=o[1]+e+o[2];while(r--){t=t.lastChild}if(!this.tbodySupport){s=this.hasTag(e,"tbody");if(n==="table"&&!s){l=t.firstChild&&t.firstChild.childNodes}else if(o[1]==="<table>"&&!s){l=t.childNodes}else{l=[]}for(f=l.length-1;f>=0;--f){a=l[f];if(a.nodeName&&a.nodeName.toUpperCase()==="tbody".toUpperCase()&&!a.childNodes.length){a.parentNode.removeChild(a)}}}e=t.childNodes;h=e.length;for(f=0;f<h;f++){u[f]=e[f]}t=i.lastChild;i.removeChild(t);e=t=i=null;return u},_featureTest:function(){var e=document.createElement("div");e.innerHTML="<link/><table></table>";this.support.htmlSerialize=!!e.getElementsByTagName("link").length;this.support.tbody=!e.getElementsByTagName("tbody").length},_extendWrapMap:function(){var e=this.wrapMap;e.optgroup=e.option;e.tbody=e.tfoot=e.colgroup=e.caption=e.thead;e.th=e.td}};SM.Html.init();if(typeof module==="object"&&module.exports){module.exports=SM.Html}var SM;if(typeof module==="object"&&module.exports&&typeof require==="function"){SM=require("../SM");require("./string");require("./html")}SM.Template={r_mustache_html_whitespace:/(([#\/\^!][^<]*%>)|([^%]>))(\s+)((<[^%])|(<%(?=[#\/\^!])))/g,whitespaceFunc:function(){return arguments[0].replace(arguments[4],"")},render:function(e,t,i){var n,o;if(!this._templates[e]){n=document.getElementById(e);if(!n){throw new Error("Template not found, id: "+e)}o=n.innerHTML;if(n.getAttribute("remove-ws")){o=o.replace(this.r_mustache_html_whitespace,this.whitespaceFunc)}o=SM.String.trim(o);this._templates[e]=o}if(t===undefined){return this._templates[e]}return Mustache.render(this._templates[e],t,i)},renderHTML:function(e,t){var i=this.render(e,t),n=SM.Html.parse(i)[0];n.parentNode.removeChild(n);return n},_templates:{}};if(typeof module==="object"&&module.exports){module.exports=SM.Template}var SM;if(typeof module==="object"&&module.exports&&typeof require==="function"){SM=require("../SM");require("./object");require("./widget");require("./template")}SM.View=SM.Object.extend(SM.Widget,{__templateID:undefined,__beforeRender:function(){return this.__settings},__render:function(e){return SM.Template.renderHTML(this.__templateID,e)},__afterRender:function(){},__update:function(e){var t=this.__beforeRender(e),i=this.el.tagName.toLowerCase(),n=i==="input"||i==="button",o=this.__render(t),r=o.attributes,s,l,a=r.length,f=0;try{for(;f<a;f++){s=r[f];l=o.getAttributeNode(s.name);if(l&&(l.nodeValue||l.nodeValue==="")&&!(n&&s.name.toLowerCase()==="type")){if(s.name==="class"){this.el.className=s.value}else{this.el.setAttribute(s.name,s.value)}}}}catch(e){SM.Error.log(e,"Error setting attribute: "+s.name+", value: "+s.name)}this.$el.html(o.innerHTML);this.__afterRender(t)},render:function(){this.__update.apply(this,arguments)},destroy:function(){this.clearBindings();if(this.__destroy){this.__destroy()}},bindModel:function(){var e,t,i,n;if(arguments.length<3){throw new Error("requires at least 3 arguments")}e=arguments[0];i=arguments[1];n=arguments[arguments.length-1];if(!$.isFunction(e.on)){throw new Error("the first argument was not a model")}if(typeof i!=="string"){throw new Error("the second argument was not an event string")}if(!$.isFunction(n)){throw new Error("the last argument was not a callback function")}t=Array.prototype.slice.call(arguments,0);t[1]=t[1]+"."+this.__NAME+this.__uid;e.on.apply(e,t.slice(1));this.__bindings.push(t)},unbindModel:function(){var e,t,i;if(arguments.length<2){throw new Error("requires at least 2 arguments")}e=arguments[0];i=arguments[1];if(arguments.length>2){t=arguments[arguments.length-1]}if(!$.isFunction(e.on)){throw new Error("the first argument was not a model")}if(typeof i!=="string"){throw new Error("the second argument was not an event string")}if(t&&!$.isFunction(t)){throw new Error("the last argument was not a callback function")}this.__removeBinding(e,i,t)},clearBindings:function(){if(this.__bindings.length){$.each(this.__bindings,function(e,t){var i=t[0],n=t[1],o=t[t.length-1];i.off(n,o)});this.__bindings=[]}},__removeBinding:function(e,t,i){var n=t+"."+this.__NAME+this.__uid,o=this.__bindings,r,s=0,l,a,f;for(;s<o.length;s++){r=o[s];a=r[0];l=r[1];f=r[r.length-1];if(a===e&&l===n){if(i){if(i===f){a.off(l,f);o.splice(s,1);s--}}else{a.off(l);o.splice(s,1);s--}}}}});SM.Views={register:function(e){if(!e.__NAME){throw new Error("the __NAME property must be defined")}if(!e.__templateID){throw new Error("the __templateID property must be defined")}e=SM.Object.extend(SM.View,e);e.__counter=0;return e},extend:function(e,t){var i=SM.Object.extend(e,t);return this.register(i)},deepExtend:function(e,t){var i=SM.Object.deepExtend(e,t);return this.register(i)},create:function(e,t){var i,n;if(e.__counter===0&&e.__setup){e.__setup()}i=SM.Object.create(e);if(t&&t.templateID){i.__templateID=t.templateID}i.__bindings=[];i.__initSettings(t);t=t||{};if(t.model){if(e.__model===undefined){throw new Error("SM.Views.create: if model option is given your view must define a __model property")}i[e.__model]=t.model}i.__uid=e.__counter++;if(typeof i.__create==="function"){i.__create(t)}n=i.__beforeRender(t);i.el=i.__render(n);i.$el=$(i.el);i.__afterRender(n);i.$el.attr("view-role",e.__NAME);$.data(i.el,e.__NAME,i);if(e.__init){i.__init(t)}i.$el.on("remove",{self:this},function(){i.destroy()});return i}};if(typeof module==="object"&&module.exports){module.exports.View=SM.View;module.exports.Views=SM.Views}SM.DialogView=SM.Views.deepExtend({__NAME:"dialog",__templateID:"dialog-template",__defaults:{isModal:false,isFixed:true,noOverlay:false,width:350,position:{my:"center",at:"center",collision:"none"},fixedPosition:null,easyClose:true,closeBtn:true},_hasShownOnce:false,__afterRender:function(){var e;this.$el.css("width",this.__settings.width);if(this.__settings.title){this.$el.attr("title",this.__settings.title)}e=this.$el.attr("title");if(e){this._addTitlebar(e);this.$el.removeAttr("title")}if(this.__settings.closeBtn){this._addCloseBtn()}if(this._hasShownOnce){this.$el.addClass("open");this.$el.removeClass("close")}else{this.$el.addClass("close");this.$el.removeClass("open")}},__onBeforeOpen:function(){$(window).on(SM.Event.RESIZE+"."+this.__NAME+this.__uid,{self:this},this._onResize);this.subscribe(SM.Event.KEYDOWN,this._onOpenKeydown);this.$el.on("click",".dialog-close-btn",{self:this},this._onCloseClick)},__onAfterOpen:function(){},__onBeforeClose:function(){$(window).off(SM.Event.RESIZE+"."+this.__NAME+this.__uid,this._onResize);this.unsubscribe(SM.Event.KEYDOWN,this._onOpenKeydown);this.$el.off("click",this._onCloseClick)},__onAfterClose:function(){},__onWindowResize:function(){if(!this.__settings.noOverlay){this.position()}},open:function(e){if(this._isOpen){return this}if(e){SM.Object.update(this.__settings,e)}this.trigger("beforeOpen");this.__onBeforeOpen();this._open();return this},update:function(e){if(e.title){this._updateTitlebar(e.title)}},close:function(){var e=$.Event("beforeClose",{dialog:this});if(!this._isOpen){return this}this.trigger(e);if(e.isDefaultPrevented()){return this}this.__onBeforeClose();this._close();return this},position:function(){var e;if(!this.__settings.position.of){this.__settings.position.of=window}e=$.migrationFixPosition({my:this.__settings.position.my,at:this.__settings.position.at,of:this.__settings.position.of,offset:this.__settings.position.offset,within:this.__settings.position.within,collision:this.__settings.position.collision});this.$el.position(e);this.trigger("position")},isOpen:function(){return this._isOpen},_$overlay:null,_isOpen:false,_open:function(){var e,t,i=this;e=SM.Template.renderHTML("dialog-container-template");this._$dialogContainer=$(e);this._$dialogContainer.appendTo(document.body);if(!this.__settings.noOverlay){t=SM.Template.renderHTML("dialog-overlay-template",{isModal:this.__settings.isModal});this._$overlay=$(t);if(this.$el.hasClass("dialog-b")){this._$overlay.addClass("dialog-overlay-b")}this._$overlay.appendTo(this._$dialogContainer);if(this.__settings.easyClose){this._$overlay.on("click",{self:this},i._onOverlayClick)}}else{this._$dialogContainer.addClass("no-overlay")}if(this.__settings.isModal&&this.__settings.isFixed){$("body").addClass("sm-fixed-dialog-modal")}this.$el.appendTo(this._$dialogContainer);setTimeout(function(){i._fadeIn()},0)},_close:function(){var e=this;if(this._$overlay){this._$overlay.removeClass("open")}this.$el.removeClass("open");this.$el.addClass("close");this._isOpen=false;this._hasShownOnce=false;if(this.__settings.isModal){$("body").removeClass("sm-fixed-dialog-modal")}setTimeout(function(){e._fadeOutComplete()},100)},_fadeIn:function(){if(this._$overlay){this._$overlay.addClass("open")}this.$el.addClass("open");this.$el.removeClass("close");if(this.__settings.isFixed&&!this.__settings.isModal){this.$el.closest(".dialog-container").addClass("fixed-dialog")}if(!this.__settings.noOverlay){this.position()}else if(this.__settings.fixedPosition){this._$dialogContainer.css(this.__settings.fixedPosition)}this._isOpen=true;this._hasShownOnce=true;this.trigger("afterOpen");this.__onAfterOpen()},_fadeOutComplete:function(){if(this._$overlay){this._$overlay.off("click");this._$overlay.remove();this._$overlay=null}this.$el.detach();this.trigger("afterClose");this._$dialogContainer.remove();this._$dialogContainer=null;this.__onAfterClose()},_addCloseBtn:function(){var e,t=this.$el.hasClass("dialog-b")?"dialog-close-btn-template-b":"dialog-close-btn-template";e=SM.Template.renderHTML(t);this.$el.prepend(e)},_updateTitlebar:function(e){this.$el.find(".dialog-title-bar").replaceWith(SM.Template.renderHTML("dialog-title-bar-template",{title:e}))},_addTitlebar:function(e){var t=SM.Template.renderHTML("dialog-title-bar-template",{title:e});this.$el.prepend(t)},_onCloseClick:function(e){e.data.self.close();e.preventDefault()},_onOverlayClick:function(e){e.data.self.close()},_onResize:function(e,t){var i=e.data.self;i.__onWindowResize(e,t)},_onOpenKeydown:function(e){var t=e.data.self;if(e.which===SM.KeyCodes.ESCAPE){t.close();e.preventDefault()}},_contains:function(e){return SM.DOM.contains(this.el,e)}});SM.Date={getDaysInMonth:function(e,t){return 32-new Date(t,e,32).getDate()},getSimpleDate:function(e){if(!e){return{}}return{month:e.getMonth(),year:e.getFullYear(),day:e.getDate()}},timestamp:function(){return(new Date).getTime()},toISOString:function(e){var t=function(e){return e<10?"0"+e:e};if(!Date.prototype.toISOString){return[this.getUTCFullYear(),"-",t(this.getUTCMonth()+1),"-",t(this.getUTCDate()),"T",t(this.getUTCHours()),":",t(this.getUTCMinutes()),":",t(this.getUTCSeconds()),"Z"].join("")}return e.toISOString()},stdTimezoneOffset:function(){var e=new Date,t=e.getFullYear(),i=new Date(t,0,1),n=new Date(t,6,1);return Math.max(i.getTimezoneOffset(),n.getTimezoneOffset())},utcOffset:function(){return(new Date).getTimezoneOffset()*-6e4},toAge:function(e){var t,i,n,o,r,s,l,a;r=Math.floor(e/1e3);t=r%60;s=Math.floor(r/60);i=s%60;l=Math.floor(s/60);n=l%24;a=Math.floor(l/24);o=a%365;return{seconds:t,minutes:i,hours:n,days:o}},ageToMilliseconds:function(e){var t=e.split(" "),i=0,n,o,r,s=0;for(;i<t.length;i++){n=t[i];o=parseInt(n,10);r=n.charAt(n.length-1);r=this._millisecondMap[r];if(r){s+=o*r}}return s},formatDigitalTime:function(e,t,i){var n="";n=this._addDigitalTimeString(n,e)+":";n=this._addDigitalTimeString(n,t)+":";return this._addDigitalTimeString(n,i)},_millisecondMap:{s:1e3,m:1e3*60,h:1e3*60*60,d:1e3*60*60*24,o:1e3*60*60*24*30,y:1e3*60*60*24*365},_addDigitalTimeString:function(e,t){if(t>9){e=e+t}else if(t>0){e=e+"0"+t}else{e=e+"00"}return e}};SM.Cookies={get:function(e){var t=this.getAll();return t[e]},set:function(e,t,i,n){var o,r;n=SM.Object.extend({path:"/"},n);if(typeof i==="string"){r=SM.Date.ageToMilliseconds(i)}else{r=i}o=new Date;o.setTime(o.getTime()+r);i=o.toGMTString();document.cookie=[e+"="+t,"expires="+i,"path="+n.path].join("; ");return this},remove:function(e,t){t=SM.Object.extend({path:"/"},t);return this.set(e,"","-1s",t)},getAll:function(){var i={},n,e=document.cookie.split(";");$.each(e,function(e,t){t=$.trim(t);n=t.split("=");if(n.length===2){i[n[0]]=n[1]}});return i}};